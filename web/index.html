<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ComfyGen Studio</title>
  <link rel="stylesheet" type="text/css" href="/comfygen/css/comfygen.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- Add Favicons here if desired -->
</head>
<body>
  <main class="main">
    <div class="container">
      <!-- Header -->
      <header class="header">
        <h1 class="header__title">ComfyGen Studio</h1>
      </header>

      <!-- Prompt Input and Settings Card -->
      <section class="card card--prompt fade-in" aria-labelledby="prompt-heading">
          <div class="prompt__container">
              <label for="prompt" class="visually-hidden">Image Prompt</label>
              <textarea id="prompt" class="prompt__textarea" placeholder="Describe your image..." aria-label="Image prompt"></textarea>
              <button id="clear-prompt-button" class="btn btn--secondary btn--clear-prompt" aria-label="Clear prompt text">Clear</button>
          </div>
          <fieldset class="settings" id="image-settings">
              <legend class="visually-hidden">Image Generation Settings</legend>
              <div class="settings__group settings__group--inline">
                  <label class="settings__label">Mode:</label>
                  <div class="settings__radio-group">
                      <input type="radio" id="mode-txt2img" name="generation-mode" value="txt2img" checked>
                      <label for="mode-txt2img">Text-to-Image</label>
                  </div>
                  <div class="settings__radio-group">
                      <input type="radio" id="mode-img2img" name="generation-mode" value="img2img">
                      <label for="mode-img2img">Image-to-Image</label>
                  </div>
              </div>
              <div id="img2img-controls" style="display: none;">
                  <div class="settings__group">
                      <label for="image-upload-input" class="settings__label">Upload Image</label>
                      <input type="file" id="image-upload-input" accept="image/*" class="settings__input">
                      <span id="uploaded-filename" class="settings__filename">No image uploaded</span>
                  </div>
                  <div class="settings__group">
                      <label for="denoise-strength" class="settings__label">Denoise Strength</label>
                      <input type="number" id="denoise-strength" class="settings__input" min="0.0" max="1.0" step="0.05" value="0.75" aria-label="Denoise strength">
                  </div>
              </div>
              <div class="settings__group">
                  <label for="image-size-preset" class="settings__label">Preset</label>
                  <select id="image-size-preset" class="settings__select" aria-label="Image size preset">
                      <option value="">Custom</option>
                      <option value="512x512">512x512</option>
                      <option value="576x1024">576x1024 (Portrait)</option>
                      <option value="768x768">768x768</option>
                      <option value="768x1344">768x1344 (Portrait)</option>
                      <option value="1024x1024">1024x1024</option>
                      <option value="1024x576">1024x576 (Landscape)</option>
                      <option value="1344x768">1344x768 (Landscape)</option>
                  </select>
              </div>
              <div class="settings__group settings__group--inline">
                  <div class="settings__subgroup">
                      <label for="image-width" class="settings__label">Width</label>
                      <input type="number" id="image-width" class="settings__input" value="576" min="64" max="2048" step="64" aria-label="Image width in pixels" />
                  </div>
                  <div class="settings__subgroup">
                      <label for="image-height" class="settings__label">Height</label>
                      <input type="number" id="image-height" class="settings__input" value="1024" min="64" max="2048" step="64" aria-label="Image height in pixels" />
                  </div>
              </div>
              <div class="settings__group settings__group--inline">
                  <div class="settings__subgroup">
                      <label for="steps" class="settings__label">Steps</label>
                      <input type="number" id="steps" class="settings__input" value="8" min="1" max="150" step="1" aria-label="Number of generation steps" />
                  </div>
                  <div class="settings__group settings__group--checkbox">
                      <input type="checkbox" id="enable-lora" class="settings__checkbox" checked />
                      <label for="enable-lora" class="settings__label">Use LoRA</label>
                  </div>
              </div>
              <div class="settings__group settings__group--inline">
                  <div class="settings__group settings__group--checkbox">
                      <input type="checkbox" id="keep-seed" class="settings__checkbox" />
                      <label for="keep-seed" class="settings__label">Keep Seed</label>
                  </div>
                  <!-- Added ID for easier access -->
                  <span id="current-seed" class="settings__seed" aria-live="polite">Seed: 0</span>
              </div>
              <div class="settings__group">
                  <label for="seed-input" class="settings__label">Custom Seed</label>
                  <input type="number" id="seed-input" class="settings__input" placeholder="Random if Keep Seed is off" aria-label="Custom seed value" />
              </div>
          </fieldset>
          <button id="send-prompt-button" class="btn btn--primary btn--full">Generate Image</button>
          <progress id="main-progress" class="progress" value="0" max="100" aria-label="Generation Progress"></progress>
      </section>

      <!-- Image Display Card -->
      <section class="card card--image fade-in" aria-labelledby="image-heading">
        <img id="maingen" class="card__image" alt="Generated image will appear here" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" />
        <div class="image-nav">
          <button id="prev-image-button" class="btn btn--secondary" disabled aria-label="Show previous image">Prev</button>
          <span id="image-counter" class="image-nav__counter" aria-live="polite">0 / 0</span>
          <button id="next-image-button" class="btn btn--secondary" disabled aria-label="Show next image">Next</button>
        </div>
      </section>

      <!-- Prompt History Section -->
      <section id="prompt-history" class="history fade-in" aria-labelledby="history-heading">
        <h3 class="history__title">Recent Prompts</h3>
        <ul id="recent-prompts-list" class="history__list" aria-label="List of recent prompts">
             <li class="empty-message">Loading...</li>
        </ul>
        <h3 class="history__title">Favorite Prompts</h3>
        <ul id="favorite-prompts-list" class="history__list" aria-label="List of favorite prompts">
             <li class="empty-message">Loading...</li>
        </ul>
      </section>

    </div> <!-- End .container -->
  </main> <!-- End .main -->

  <!-- JavaScript Module Imports - ORDER MATTERS! -->
  <script type="module" src="/comfygen/js/utils.js"></script>
  <script type="module" src="/comfygen/js/api.js"></script>
  <!-- UI Modules -->
  <script type="module" src="/comfygen/js/ui_elements.js"></script>
  <script type="module" src="/comfygen/js/ui_helpers.js"></script>
  <script type="module" src="/comfygen/js/ui_prompt_controls.js"></script>
  <script type="module" src="/comfygen/js/ui_image_display.js"></script>
  <script type="module" src="/comfygen/js/ui_history.js"></script>
  <!-- Managers -->
  <script type="module" src="/comfygen/js/websocket_manager.js"></script>
  <script type="module" src="/comfygen/js/settings_manager.js"></script>
  <script type="module" src="/comfygen/js/image_management.js"></script>
  <script type="module" src="/comfygen/js/prompt_management.js"></script>
  <script type="module" src="/comfygen/js/seed_management.js"></script>
  <!-- Initialization & Main App Logic -->
  <script type="module" src="/comfygen/js/app_init.js"></script>
  <script type="module" src="/comfygen/js/app.js"></script>

</body>
</html>